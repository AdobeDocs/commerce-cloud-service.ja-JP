---
title: 拡張されたアーキテクチャ
description: 分割層アーキテクチャと、需要に応じた拡張方法について説明します。
feature: Cloud, Auto Scaling, Iaas, Logs
exl-id: c54d8772-b6cc-41cc-b1ab-bef7d6f13bf2
source-git-commit: 8a0523f1714b6ea41887e99b5c31294cf5e5255e
workflow-type: tm+mt
source-wordcount: '816'
ht-degree: 0%

---

# 拡張されたアーキテクチャ

クラウドインフラストラクチャは、リソース要件に応じて拡張し、効率を高めます。 クラウドインフラストラクチャー上のAdobe Commerceは、アプリケーションを監視し、処理能力を調整して、安定した予測可能なパフォーマンスを維持できます。 このアーキテクチャに変換すると、待ち時間やトラフィックの大きなスパイクなどの問題を軽減できます。

>[!NOTE]
>
>拡張アーキテクチャは、Pro 48 クラスター以降のクラウドインフラストラクチャアカウント上のAdobe Commerceで使用できます。

## 分割層アーキテクチャ

従来、Pro アーキテクチャは 3 つのノードで構成され、各ノードには完全な技術スタックが含まれていました。 現在、6 つ以上のノードを持つ階層型アーキテクチャを提供する、拡張性の高いインフラストラクチャが存在します。つまり、コア・データベースおよびサービス用に 3 つのノード、Web サーバ用に 3 つのノードです。 このスプリット階層アーキテクチャでは、最適なパフォーマンス・バランスを実現するために個別に階層を拡張する機能が提供されます。

### サービス層

データストレージ、キャッシュ、サービスの 3 つのサービスノードがあります。 **OpenSearch** または **Elasticsearch**, **MariaDB**, **Redis**、など。 サービス層が処理能力に近づいた場合、拡張する唯一の方法は、CPU の電力やメモリの増加など、サーバーのサイズを大きくすることです。 処理能力は、使用できるノードのサイズによって制限されます。 データベースクラスターは高可用性を実現するように設計されているので、使用されるテクノロジーでは、信頼性の高い方法で水平方向にスケールすることはできません。

![サービス層の拡張](../../assets/scaling-service.png)

サービスノードインスタンスタイプの例を考えてみましょう。 _m5.2xlarge_ 32 Gb の RAM 搭載。 データベースなどのサービスは、かなりの量のメモリ（30 Gb）を使用します。 次に使用可能なインスタンスサイズへの拡大・縮小 _m5.4xlarge_ は 64 Gb の RAM を提供し、メモリが 2 倍になり、データベースの増大するニーズに対応できます。

ノードタイプに基づいてトラフィックをルーティングすることで、サービス層のパフォーマンスをさらに最適化できます。 デフォルトでは、データベースノードは web トラフィックから分離されています。 例えば、データベースノードで web トラフィックを提供するように選択できます。

### Web 層

リクエストと web トラフィックを処理する web ノードは 3 つあります。 **php-fpm** および **NGINX**. Web 層は、電力とメモリを増大させることで垂直方向のスケーリングに加えて、PHP レベルで縮小した場合に既存のクラスタに Web サーバを追加することで水平方向のスケーリングが可能です。 参照： [自動スケーリング](autoscaling.md) web ノードの自動スケーリング方法を説明します。

![Web 階層の拡張](../../assets/scaling-web.png)

これは、サービス層が提供する垂直方向のスケーリングを補完するものです。 サービス層のサイズと電力は、増大するデータベースとサービスの使用に対応して拡張されるため、Web 層のサイズ、電力、インスタンスは、プロセス・リクエストの増加やトラフィック要件の増加に対応して拡張されます。

Web ノードインスタンスタイプの例を考えてみましょう。 _8 基の CPU と 16 Gb の RAM を搭載した C5.2xlarge_. サイトへのリクエスト数が大幅に増加しました。 C5.2xlarge ノードを追加して、php-fpm プロセスの増加に対処するか、各インスタンスタイプをに変更することができます。 _C5.4xlarge （16 CPU および 32-Gb RAM）_. ノードを追加すると、サージ容量が不十分になるリスクが軽減されます。

## プロジェクト構造

最小で、Scaled アーキテクチャを使用する Pro プロジェクトでは、6 つのノードを使用できます。

- 3 つの Web ノード c5.2xlarge （8 CPU、16 Gb RAM）

- 3 つのサービスノード m5.2xlarge （8 CPU、32 Gb RAM）

ただし、各プロジェクトは固有であり、リソース管理を適切に分析するためのパフォーマンス監視が必要です。 各アカウントには、 [New Relic サービス](../monitor/new-relic-service.md)アプリケーションデータおよびパフォーマンス分析と自動的に接続し、動的なサーバー監視を提供します。 特に、New Relic サービスを使用して CPU と RAM の使用率を監視すると、追加のリソースが必要なノードを判断できます。 リソースが処理能力に達するか、分析に基づくパフォーマンスの低下に気付いた場合、リクエストを作成して、需要に合わせてインフラストラクチャを拡張できます。

### SSH アクセス

特定のファイルおよびログ（など） `/app/<project-id>/var/log` ディレクトリは、ノード間で共有されません。 各ノードには一意の SSH アクセス権があります。 は使用できません `magento-cloud` CLI を使用してサービスまたは Web ノードにログインするが、 [!DNL Cloud Console].

```bash
ssh <node>.<project-ID>-<environment>-<user-ID>@ssh.<region>.magento.com
```

- `node` 1～3：サービス・ノードにアクセスするためのアドレス

- `node` 4 ～ _n_— Web ノードにアクセスするアドレス

>[!TIP]
>
>ログインしたら、サーバー ID と役割を確認できます。サービスノードでは、 _unified_ の役割および web ノードでは、 _web_ 役割。

にログインしたときの応答の例 **サービスノード** 次を含む _unified_ 役割：

```terminal
 __  __                   _          ___ _             _
|  \/  |__ _ __ _ ___ _ _| |_ ___   / __| |___ _  _ __| |
| |\/| / _` / _` / -_) ' \  _/ _ \ | (__| / _ \ || / _` |
|_|  |_\__,_\__, \___|_||_\__\___/  \___|_\___/\_,_\__,_|
            |___/

 Welcome to Magento Cloud.

 This is server unique-server-id, role project-id:unified.

project-id@server-id:~$
```

にログインしたときの応答の例 **web ノード** 次を含む _web_ 役割：

```terminal
 __  __                   _          ___ _             _
|  \/  |__ _ __ _ ___ _ _| |_ ___   / __| |___ _  _ __| |
| |\/| / _` / _` / -_) ' \  _/ _ \ | (__| / _ \ || / _` |
|_|  |_\__,_\__, \___|_||_\__\___/  \___|_\___/\_,_\__,_|
            |___/

 Welcome to Magento Cloud.

 This is server unique-server-id, role project-id:web.

project-id@server-id:~$
```

### ログの場所

ログの場所は、ノードによって若干異なります。 例えば、次のようなデータベースログ **MySQL エラーログ**&#x200B;は、サービスノード（`/var/log/mysql/mysql-error.log`）、ただし web ノードでは使用できません。

各 Pro アカウントには、 [New Relic ログサービス](../monitor/new-relic-service.md)アプリケーションのログデータと自動的に接続し、動的なログ管理を提供します。 すべてのノードからの集計ログデータがNew Relicのログアプリケーションに表示されるので、1 つのダッシュボードから特定のノードのパフォーマンスの問題をトラブルシューティングできます。
