---
title: ステージングと実稼動のテスト
description: ステージング環境と実稼動環境でテストする方法を説明します。
exl-id: 5b762d59-04c5-4e89-a637-719141759158
source-git-commit: 1253d8357fd2554050d1775fefbc420a2097db5f
workflow-type: tm+mt
source-wordcount: '1329'
ht-degree: 0%

---

# ステージングと実稼動のテスト

コード、ファイル、データのステージング環境または実稼動環境への移行が成功したら、環境 URL を使用してサイトとストアをテストします。 ログの検証、Fastly 設定のテスト、ユーザー受け入れテスト（UAT）などの情報を以下に示します。

## ログファイル

デプロイメントでエラーが発生した場合や、テスト中にほかの問題が発生した場合は、ログファイルを確認します。 ログファイルはの下にあります。 `var/log` ディレクトリ。

デプロイメントログはにあります。 `/var/log/platform/<prodject-ID>/deploy.log`. 次の値 `<project-ID>` プロジェクト ID と、環境がステージング環境か実稼動環境かによって異なります。 例えば、プロジェクト ID がの場合 `yw1unoukjcawe`の場合、ステージングユーザーはです。 `yw1unoukjcawe_stg` 実稼動ユーザーは `yw1unoukjcawe`.

実稼動環境またはステージング環境でログにアクセスする場合は、SSH を使用して 3 つのノードのそれぞれにログインしてログを探します。 または、次を使用できます [New Relic ログ管理](../monitor/log-management.md) すべてのノードの集約ログ・データを表示およびクエリーします。 参照： [ログを表示](log-locations.md#application-logs).

## コードベースの確認

コードベースがステージング環境および実稼動環境に正しくデプロイされていることを確認します。 環境には、同一のコードベースが必要です。

## 設定の検証

管理パネルで、ベース URL、ベース管理 URL、マルチサイト設定などの設定を確認します。 追加で変更が必要な場合は、ローカル Git ブランチで編集を完了し、にプッシュします。 `master` 統合、ステージングおよび実稼動のブランチ。

## Fastly キャッシュを確認する

[Fastly の設定](../cdn/fastly-configuration.md) 正しい Fastly サービス ID と Fastly API トークン資格情報の使用、Fastly VCL コードのアップロード、DNS 設定の更新、環境への SSL/TLS 証明書の適用など、詳細に注意する必要があります。 これらのセットアップタスクを完了したら、ステージング環境と実稼動環境で Fastly キャッシュを検証できます。

**Fastly サービス設定を検証するには**:

1. URL を次と使用して、ステージング環境と実稼動環境の管理者にログインします。 `/admin`、または [更新された管理者 URL](../environment/variables-admin.md#admin-url).

1. に移動します。 **ストア** > **設定** > **設定** > **詳細** > **システム**. スクロールしてクリック **フルページキャッシュ**.

1. 必ずを **キャッシュアプリケーション** 値はに設定されています。 _Fastly CDN_ .

1. Fastly 資格情報をテストします。

   - クリック **Fastly 設定**.

   - Fastly サービス ID と Fastly API トークン資格情報の値を確認します。 参照： [Fastly 資格情報の取得](/help/cloud-guide/cdn/fastly-configuration.md#get-fastly-credentials).

   - クリック **テスト資格情報**.

   >[!WARNING]
   >
   >ステージング環境と実稼動環境で、正しい Fastly サービス ID と API トークンを入力したことを確認します。 Fastly の資格情報は、サービス環境ごとに作成およびマッピングされます。 実稼動環境にステージング資格情報を入力した場合、VCL スニペットをアップロードできず、キャッシュが正しく機能せず、キャッシュ設定が間違ったサーバーとストアを指しています。

**Fastly のキャッシュ動作を確認するには**:

1. を使用してヘッダーを確認する `dig` サイト構成に関する情報を取得するためのコマンド ライン ユーティリティ。

   で任意の URL を使用できます `dig` コマンド。 次の例では、Pro URL を使用しています。

   - ステージング： `dig https://mcstaging.<your-domain>.com`
   - 実稼動： `dig https://mcprod.<your-domain>.com`

   その他の情報 `dig` テスト、「Fastly」を参照 [DNS 変更前のテスト](https://docs.fastly.com/en/guides/working-with-domains).

1. 使用方法 `cURL` 応答ヘッダー情報を検証します。

   ```bash
   curl https://mcstaging.<your-domain>.com -H "host: mcstaging.<your-domain.com>" -k -vo /dev/null -H Fastly-Debug:1
   ```

   参照： [応答ヘッダーを確認](../cdn/fastly-troubleshooting.md#check-cache-hit-and-miss-response-headers) ヘッダーの検証について詳しくは、を参照してください。

1. 使用後は、を使用します `cURL` ライブサイトを確認する場合。

   ```bash
   curl https://<your-domain> -k -vo /dev/null -H Fastly-Debug:1
   ```

## UAT テストの完了

ステージング環境と実稼動環境でユーザー受け入れテスト（UAT）を実施します。 次のテストは、マーチャントおよび顧客としてテストする必要があるタスクと領域の簡単なリストです。 リストは長くなる場合があり、カスタムモジュール、拡張機能、サードパーティ統合の追加テストが含まれる場合があります。 テストするときは、デスクトップ、ノートパソコン、モバイルデバイスを使用します。

問題が発生した場合は、再生手順、エラーメッセージ、不審な画面キャプチャ、リンクを保存します。 この情報を使用して、統合環境のコードと設定、または環境設定の問題を調査し、修正します。

<table>
<tr>
<td style="width:150px">ユーザー管理</td>
<td>
<ul>
<li>顧客アカウントの作成と編集、メールの検証</li>
<li>マーチャントの管理者ロールの作成</li>
<li>特定の役割を持つマーチャントアカウントの作成</li>
<li>役割ごとのマーチャントアカウントアクセスのテスト</li>
</ul>
</td>
</tr>
<tr>
<td>カタログ・製品</td>
<td>
<ul>
<li>関連製品を含むカタログの作成</li>
<li>シンプル、設定可能、バンドルなどのすべての製品タイプを含む、ストアフロントの製品を作成します。</li>
<li>製品画像、スウォッチ、ビデオ、その他のメディアオプションの追加</li>
<li>価格、割引、価格ルールの構成 </li>
<li>価格範囲、おすすめ製品、利用日などの高度な機能を設定します</li>
<li>在庫の変更および正しい値の表示の検証と、増加および完了した購入ごとの変更</li>
</ul>
</td>
</tr>
<tr>
<td>買い物かご&amp;チェックアウト</td>
<td>
<ul>
<li>製品を検索してフィルタリングオプションを選択します。</li>
<li>検索結果、カテゴリページ、製品ページから買い物かごに製品を追加する</li>
<li>すべての製品タイプのテスト</li>
<li>カートを表示し、金額を削除または変更してコンテンツを変更します </li>
<li>チェックアウトを実行して、買い物かごや商品情報に対する注文金額を確認します</li>
<li>税金が買い物かごに対して正しく計算されることを確認します</li>
<li>クーポンの追加、配送の選択、配送および請求情報の入力、支払い情報など、さまざまなオプションで購入を完了します</li>
<li>チェックアウト時の支払いゲートウェイとオプションの確認</li>
<li>画面上の通知、顧客アカウントにリストされている注文、メール通知を確認します</li>
<li>ゲストおよび顧客チェックアウトのテスト</li>
</ul>
</td>
</tr>
<tr>
<td>オーダー管理</td>
<td>
<ul>
<li>顧客の注文の作成</li>
<li>注文の検索と表示</li>
<li>商品の追加と削除、金額の変更、出荷および請求情報の変更による注文の変更</li>
<li>払い戻しを処理する</li>
<li>注文をキャンセル</li>
<li>クーポンコードと割引の適用</li>
</ul>
</td>
</tr>
<tr>
<td>サイトコンテンツ</td>
<td>
<ul>
<li>すべてのテーマとアセットが正しく読み込まれていることを確認します</li>
<li>レスポンシブメディアサイズを含め、CSS が正しく表示されることを確認します</li>
<li>利用条件、返金ポリシー、その他のポリシー情報を確認する</li>
<li>会社の連絡先情報やリンクなどを確認します</li>
<li>製品とコンテンツを検索し、結果のフィルタリングを確認する</li>
<li>フッターブロックと上部ナビゲーションブロックの確認</li>
<li>404 およびメンテナンスページのテスト</li>
</ul>
</td>
</tr>
<tr>
<td>拡張機能</td>
<td>
<ul>
<li>特に課税、配送、支払いモジュール（例：倉庫への注文と財務管理システム）に関するすべての拡張機能設定を確認します。</li>
<li>カスタマイズしたモジュールとインストール済みの拡張機能のすべてのインタラクションをテスト</li>
<li>完了する必要があるインタラクション（支払、注文、メール通知）のデータを確認します</li>
<li>拡張機能の環境ごとの設定の確認</li>
<li>モジュールと拡張機能の間の依存関係が機能することを確認します</li>
<li>マーチャントおよび顧客としてのすべてのアクションを確認します</li>
</ul>
</td>
</tr>
<tr>
<td>サードパーティの統合</td>
<td>
<ul>
<li>データがAdobe Commerceに正しく保存され、サードパーティのサービスがエクスポート、プッシュ、またはアクセスできることを確認します（例：サードパーティのオーダー管理システムでの注文の表示）</li>
<li>統合ごとの設定とインタラクションの検証</li>
<li>Adobe Commerceとサードパーティのサービスを起点とするラウンドトリップテストを実行します。</li>
<li>認証が完了したことを確認します。</li>
<li>ログに記録された問題を確認して、コントロールパネルでコード統合やエラーメッセージを更新します</li>
</ul>
</td>
</tr>
<tr>
<td>バックエンドテスト</td>
<td>
<ul>
<li>キャッシュのテストとクリア </li>
<li>再インデックスの実行と結果の検証</li>
<li>cron ジョブをチェックし、cron_schedule エラーをチェックします。</li>
<li>シェルスクリプトの問題の確認とチェック</li>
<li>ログに記録された問題（アプリケーションログ、PHP ログ、MySQL ログ、メールログ）を確認します。</li>
</ul>
</td>
</tr>
</table>

## 負荷テストとストレステスト

起動する前に、ステージング環境と実稼動環境で広範なトラフィックおよびパフォーマンステストを実行することをお勧めします。 フロントエンドプロセスとバックエンドプロセスのパフォーマンステストを検討します。

テストを開始する前に、サポートに対して、テストする環境、使用するツール、期間についてアドバイスするチケットを入力します。 パフォーマンスを追跡するための結果と情報を使用してチケットを更新します。 テストを完了したら、更新した結果とメモをチケットテストに追加して、日付と時刻のスタンプを記入して完了します。

をレビュー [Performance Toolkit](https://github.com/magento/magento2/tree/2.4/setup/performance-toolkit) ローンチ前準備プロセスの一部としてのオプション。

最適な結果を得るには、次のツールを使用します。

- [アプリケーションパフォーマンステスト](../environment/variables-post-deploy.md#ttfb_tested_pages) – アプリケーションのパフォーマンスをテストするには、 `TTFB_TESTED_PAGES` サイトの応答時間をテストするための環境変数。
- [包囲](https://www.joedog.org/siege-home/) – トラフィックのシェーピングとテストを行うソフトウェアで、ストアを限界まで押し上げます。 設定可能な数のシミュレーションクライアントを使用して、サイトをヒットします。 Siege では、基本認証、Cookie、HTTP、HTTPS、および FTP プロトコルをサポートしています。
- [Jmeter](https://jmeter.apache.org) – 優れた負荷テストにより、フラッシュ・セールスなどの急増するトラフィックのパフォーマンスを測定できます。 サイトに対して実行するカスタムテストを作成します。
- [New Relic](../monitor/new-relic-service.md) （提供） – データ、クエリ、Redis などの送信など、アクションごとの追跡時間でパフォーマンスの低下を引き起こしているサイトのプロセスと領域を見つけるのに役立ちます。
- [WebPageTest](https://www.webpagetest.org) および [Pingdom](https://www.pingdom.com)- サイトページの読み込み時間を様々なオリジンの場所でリアルタイムに分析します。 Pingdom には手数料が必要な場合があります。 WebPageTest は無料のツールです。

## 機能テスト

Magento機能テストフレームワーク（MFTF）を使用すると、Cloud Docker 環境からAdobe Commerceの機能テストを実行できます。 参照： [アプリケーションテスト](https://developer.adobe.com/commerce/cloud-tools/docker/test/application-testing/) が含まれる _Cloud Docker for Commerce ガイド_.

## セキュリティスキャンツールの設定

サイトには無料のセキュリティスキャンツールがあります。 サイトを追加してツールを実行するには、を参照してください。 [セキュリティ スキャン ツール](../launch/overview.md#set-up-the-security-scan-tool).
